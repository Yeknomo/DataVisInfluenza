<!DOCTYPE html>
<html>

<head>
	<title>Assignment 4</title>
	<script src='https://d3js.org/d3.v4.min.js'></script>
	<script src='https://d3js.org/topojson.v1.min.js'></script>
</head>
 <style>

.states {
  fill: #ccc;
  stroke: #fff;
}
</style>
<body>

	<script>

d3.csv('avianData.csv', function(error,avianData){	
d3.csv('humanData.csv', function (error,humanData){

//*************************************DATASETS/DATA TRANSFORMATION****************************************************

avianData.forEach(function(d) {
        d.CollectionDate = d.CollectionDate.split("/");
		d.CollectionDate = new Date(d.CollectionDate[2],d.CollectionDate[0]-1,d.CollectionDate[1]);
		d.EndDate = new Date (d.CollectionDate.getFullYear(),d.CollectionDate.getMonth(),d.CollectionDate.getDate()+14);
		d.CollectionDate = d.CollectionDate.getTime()/86400000;
		d.EndDate = d.EndDate.getTime()/86400000;
    })
humanData.forEach(function(d) {
		d.Age = d.Age.split(",");
		d.Age = d.Age[0];
		
		d.CollectionDate = d.CollectionDate.split(",");
		d.CollectionDate = d.CollectionDate[0];
		d.CollectionDate = d.CollectionDate.split("/");
		d.CollectionDate = new Date(d.CollectionDate[2],d.CollectionDate[0]-1,d.CollectionDate[1])
		
		
		if ((d.Age >= 65) || (d.Age <= 10)){
    			d.EndDate = new Date (d.CollectionDate.getFullYear(),d.CollectionDate.getMonth(),d.CollectionDate.getDate()+14);
  		 } else {d.EndDate = new Date (d.CollectionDate.getFullYear(),d.CollectionDate.getMonth(),d.CollectionDate.getDate()+7);}
		
		d.EndDate = d.EndDate.getTime()/86400000;
		d.CollectionDate = d.CollectionDate.getTime()/86400000;

		 if (d.Temperature == "-N/A-") {
			d.Temperature = "0"
			}
		d.Temperature = +d.Temperature;
		
		if (d.isVaccinated == "1" || d.isVaccinated == "Yes" || d.isVaccinated == "Y") {
			d.isVaccinated = "Y"
			}else {d.isVaccinated = "N"}
		
		if (d.Fever == "1" || d.Fever == "Yes" || d.Fever == "Y") {
			d.Fever = "Y"
			}else {d.Fever = "N"}
			
		d.Symptoms = d.Symptoms.split(",")
	        if (d.Temperature > 99) {
    			var i = 0
      			var counter = 1
      			var k = d.Symptoms.length
      			for(i;i<k;i++){
      				var currentSymptom = d.Symptoms[i]
        			if(currentSymptom.includes("cough")){
        			  var currentArray = currentSymptom.split('(');
					  currentArray = currentArray[1]
				  if ((currentArray.includes("Y") || currentArray.includes("M")) || currentArray.includes("4")) {
          				counter = counter +1 
         			   }
       				 } 
        			if(currentSymptom.includes("myalgia")){
        			  var currentArray = currentSymptom.split('(');
					  currentArray = currentArray[1]
				  if ((currentArray.includes("Y") || currentArray.includes("M")) || currentArray.includes("4")) {
          				counter = counter +1 
         			   }
       				 } 
				 if (counter == 3) { d.Symptoms = 1; i = k; }
			} 
			if (counter<3) {
				d.Symptoms = 0; 
			}
    		}
		d.State = d.State.trim();
		d.Subtype = d.Subtype.split(",");
		d.Subtype = d.Subtype[0];
		if (d.Subtype == "-N/A-" || d.Subtype == "unknown"){
			d.Subtype = "-N/A-"
			}
})

//More datasets 
var ageCohorts = [
	{Index: '0',  Age: 'Under 5' , Percent: 0.0654304581399327}, 
	{Index: '1',  Age: '5 to 9' , Percent: 0.065907533860457 } ,
	{Index: '2',  Age: '10 to 14' , Percent: 0.0669716366880742 }, 
	{Index: '3',  Age: '15 to 19' , Percent: 0.0713867579844992 } ,
	{Index: '4',  Age: '20 to 24' , Percent: 0.0699151772033059 } ,
	{Index: '5',  Age: '25 to 29' , Percent: 0.0683470573751255 } ,
	{Index: '6',  Age: '30 to 34' , Percent: 0.0646555060497749 } ,
	{Index: '7',  Age: '35 to 39' , Percent: 0.065360108945121 } ,
	{Index: '8',  Age: '40 to 44' , Percent: 0.067664019163898 } ,
	{Index: '9',  Age: '45 to 49' , Percent: 0.0735511552558858 } ,
	{Index: '10',  Age: '50 to 54' , Percent: 0.0722216915082996 } ,
	{Index: '11',  Age: '55 to 59' , Percent: 0.0636925965874202 } ,
	{Index: '12',  Age: '60 to 64' , Percent: 0.0544717961235767 } ,
	{Index: '13',  Age: '65 to 69' , Percent: 0.0402767375378231 } ,
	{Index: '14',  Age: '70 to 74' , Percent: 0.0300511743751905 } ,
	{Index: '15',  Age: '75 to 79' , Percent: 0.0237017028566742 } ,
	{Index: '16',  Age: '80 to 84' , Percent: 0.0186021376606907 } ,
	{Index: '17',  Age: '85 to 89' , Percent: 0.0117263524631083 } ,
	{Index: '18',  Age: '90 to 94' , Percent: 0.00469113176301191} ,
	{Index: '19',  Age: '95 to 99' , Percent: 0.00120242709386135} ,
	{Index: '20',  Age: '100+' , Percent: 0.000172841364269368 }  ];
	
	
var predictedStrains = ["H1N1" ,"H3N2"];
 
	
var stateData = [
  {State: 'Alabama', Population: '4849377' , Latitude: '32.361538 ', Longitude: '-86.279118' } , 
 {State: 'Alaska', Population: '737732' , Latitude: '58.301935 ', Longitude: '-134.41974' } , 
 {State: 'Arizona', Population: '6731484' , Latitude: '33.448457 ', Longitude: '-112.073844' } , 
 {State: 'California', Population: '38802500' , Latitude: '38.555605 ', Longitude: '-121.468926' } , 
 {State: 'Colorado', Population: '5355856' , Latitude: '39.7391667 ', Longitude: '-104.984167' } , 
 {State: 'Delaware', Population: '935614' , Latitude: '39.161921 ', Longitude: '-75.526755' } , 
 {State: 'DistrictofColumbia', Population: '658893' , Latitude: '38.913 ', Longitude: '77.013' } , 
 {State: 'Florida', Population: '19893297' , Latitude: '30.4518 ', Longitude: '-84.27277' } , 
 {State: 'Georgia', Population: '10097343' , Latitude: '33.76 ', Longitude: '-84.39' } , 
 {State: 'Hawaii', Population: '1419561' , Latitude: '21.30895 ', Longitude: '-157.826182' } , 
 {State: 'Illinois', Population: '12880580' , Latitude: '39.78325 ', Longitude: '-89.650373' } , 
 {State: 'Kentucky', Population: '4413457' , Latitude: '38.197274 ', Longitude: '-84.86311' } , 
 {State: 'Louisiana', Population: '4649676' , Latitude: '30.45809 ', Longitude: '-91.140229' } , 
 {State: 'Maryland', Population: '5976407' , Latitude: '38.972945 ', Longitude: '-76.501157' } , 
 {State: 'Massachusetts', Population: '6745408' , Latitude: '42.2352 ', Longitude: '-71.0275' } , 
 {State: 'Michigan', Population: '9909877' , Latitude: '42.7335 ', Longitude: '-84.5467' } , 
 {State: 'Mississippi', Population: '2984926' , Latitude: '32.32 ', Longitude: '-90.207' } , 
 {State: 'Nebraska', Population: '1881503' , Latitude: '40.809868 ', Longitude: '-96.675345' } , 
 {State: 'Nevada', Population: '2839099' , Latitude: '39.160949 ', Longitude: '-119.753877' } , 
 {State: 'NewJersey', Population: '8938175' , Latitude: '40.221741 ', Longitude: '-74.756138' } , 
 {State: 'NewYork', Population: '19746227' , Latitude: '42.659829 ', Longitude: '-73.781339' } , 
 {State: 'NorthCarolina', Population: '9943964' , Latitude: '35.771 ', Longitude: '-78.638' } , 
 {State: 'Ohio', Population: '11594163' , Latitude: '39.962245 ', Longitude: '-83.000647' } , 
 {State: 'Oklahoma', Population: '3878051' , Latitude: '35.482309 ', Longitude: '-97.534994' } , 
 {State: 'SouthCarolina', Population: '4832482' , Latitude: '34 ', Longitude: '-81.035' } , 
 {State: 'SouthDakota', Population: '853175' , Latitude: '44.367966 ', Longitude: '-100.336378' } , 
 {State: 'Tennessee', Population: '6549352' , Latitude: '36.165 ', Longitude: '-86.784' } , 
 {State: 'Texas', Population: '26956958' , Latitude: '30.266667 ', Longitude: '-97.75' } , 
 {State: 'Virginia', Population: '8326289' , Latitude: '37.54 ', Longitude: '-77.46' } , 
 {State: 'Washington', Population: '7061530' , Latitude: '47.042418 ', Longitude: '-122.893077' } , 
];

var totalPop = 250442956;

var makeShareDataA = function(d) { //Only strains shared with humans
		var i = 0; 
        var k = d.length;
		
        var newDataset = []; //Our filtered dataset
		
        for(i; i<k; i++) {
            var currentStrain = d[i].Subtype;
            if (currentStrain.toUpperCase() == "H1N1".toUpperCase() ||
				currentStrain.toUpperCase() == "H3".toUpperCase() ||
				currentStrain.toUpperCase() == "H3N2".toUpperCase() ||
				currentStrain.toUpperCase() == "HXNX".toUpperCase() ||
				currentStrain.toUpperCase() == "-N/A-".toUpperCase()) {
            	newDataset.push(d[i]);
				}
			}
		return newDataset;
	}
makeShareDataH = function(d) {
		var i = 0; 
        var k = d.length;
		
        var newDataset = []; //Our filtered dataset
		
        for(i; i<k; i++) {
            var currentStrain = d[i].Subtype;
            if ((currentStrain.toUpperCase()) !== ("H3NY".toUpperCase()) &&
				(currentStrain.toUpperCase()) !== ("N2".toUpperCase()) &&
				(currentStrain.toUpperCase()) !== ("pdmH1".toUpperCase()))	{
            	newDataset.push(d[i]);
				}
			}
		return newDataset;
	}


var sharedHuman = makeShareDataH(humanData)
var sharedAvian = makeShareDataA(avianData)


//*************************************FILTERS****************************************************

// state filter 
var filterState = function(d,State) { 

        var i = 0; 
        var k = d.length;
		
        var newDataset = []; //Our filtered dataset
		
        for(i; i<k; i++) {
            var currentState = d[i].State;
            if (currentState == State) {
            	newDataset.push(d[i]);
				}
			}
			return newDataset;
	}
 
//  Gender Filter 
var filterGender =  function(d,Gender) { 

        var i = 0; 
        var k = d.length;
		
        var newDataset = []; //Our filtered dataset
		
        for(i; i<k; i++) {
            var currentGender = d[i].Gender;
            if (currentGender == Gender) {
            	newDataset.push(d[i]);
				}
			}
			return newDataset;
	}  
  
 // Symptom filter   for this to work we will need to determine if they have symptoms earlier and set it to a boolean <- 1 is symptotmatic
var filterSymptoms = function(d,Symptoms) { 
        var i = 0; 
        var k = d.length;
		
        var newDataset = []; //Our filtered dataset
		
        for(i; i<k; i++) {
            var currentSymptoms = d[i].Symptoms;
            if (currentSymptoms == 1) {
            	newDataset.push(d[i]);
				}
			}
			return newDataset;
	}
 
  
// age filter 

var filterAge =  function(d,ageIndex) { // can use age index  

    	var minAge = ageIndex*5;
        var maxAge = minAge + 4; 
        var i = 0; 
        var k = d.length;
        var newDataset = []; //Our filtered dataset
        for(i; i<k; i++) {
        	var currentAge = d[i].Age
					if(currentAge >= minAge) {
							if(minAge >= 100) {newDataset.push(d[i]);}
              else if (currentAge <= maxAge) {newDataset.push(d[i]);}
              }
        }
		return newDataset;
   	}
  
// Strain filter 
var filterStrain = function(d,Strain) { // change to map graphic 

        var i = 0; 
        var k = d.length;
		
        var newDataset = []; //Our filtered dataset
		
        for(i; i<k; i++) {
            var currentStrain = d[i].Subtype;
            if (currentStrain.toUpperCase() == Strain.toUpperCase()) {
            	newDataset.push(d[i]);
				}
			}
		return newDataset;
	}  
  
	
//*************************************STATS****************************************************
	
//Stats//Graph 1: The Map....

var graph1Stats = function(d, stateData){
	var minCollectionDate = 1487785065794;
    var maxEndDate = 0;
   	var i = 0;
    var k = d.length;
    for(i;i<k;i++){
    	var currentCollectionDate = d[i].CollectionDate;
      var currentEndDate = d[i].endDate;
      if(currentCollectionDate < minCollectionDate){
      	minCollectionDate = currentCollectionDate;
      }
      if(currentEndDate > maxEndDate){
      	maxEndDate = currentEndDate;
      } else{
      	continue;
      }
    }
    var oneData = [];
    var j = 0;
    var l = stateData.length
    for (j; j < l; j++){
    	var searchingState = stateData[j].State;
       var count = 0;
       for(minCollectionDate; minCollectionDate < maxEndDate; minCollectionDate++){
         var i = 0;
         for(i;i<k;i++){
           if((d[i].CollectionDate < minCollectionDate) && (d[i].endDate > minCollectionDate)){
             	if(d[i].State = searchingState){
              	count = count+1;
           		}
           }
           continue;
         }
         oneData.push({Date: minCollectionDate, State: searchingState, Latitude: stateData[j].Latitude, Longitude: stateData.Longitude, Value: count });
         continue;
        } 
        }
	return oneData;
}


 //Stats//Graph 2: Quantity of Infections
var graph2Stats = function(human,avian) {
	var minCollectionDateH = 100000000000000;
	var maxEndDateH = 0;
	var minCollectionDateA = 100000000000000;
	var maxEndDateA = 0;
    var kh = human.length;
	var ka = avian.length;
	
	//Find earliest and latest date in human dataset
    for(i=0;i<kh;i++){

    var currentCollectionDate = human[i].CollectionDate;
	var currentEndDate = human[i].EndDate;
		
    if(currentCollectionDate < minCollectionDateH){
      	minCollectionDateH = currentCollectionDate;
      }
    if(currentEndDate > maxEndDateH){
      	maxEndDateH = currentEndDate;
      } 
    }
	
	
	//Find earliest and latest date in avian dataset
	for(i=0;i<ka;i++){

    var currentCollectionDate = avian[i].CollectionDate;
	var currentEndDate = avian[i].EndDate;
		
    if(currentCollectionDate < minCollectionDateA){
      	minCollectionDateA = currentCollectionDate;
      }
    if(currentEndDate > maxEndDateA){
      	maxEndDateA = currentEndDate;
      } 
    }
/*
	//Choose the stricter values
	var minCollectionDate = Math.max(minCollectionDateH,minCollectionDateA)
	var maxEndDate = Math.min(maxEndDateH,maxEndDateA);
	*/
    var twoData = [];//both
	var twoDataH = [];//human
	var twoDataA = [];//avian
	
	//Find count of contagious at date - human
    for(currentDate = minCollectionDateH; currentDate < maxEndDateH; currentDate++){
		
		var count = 0;
		
      for(i=0;i<kh;i++){
      	if((human[i].CollectionDate <= currentDate) && (human[i].EndDate >= currentDate)){
        	count = count+1; 
        }
      }
      twoDataH.push({Date: currentDate, Value: count });
    }
	
	//Find count of contagious at date - avian
	for(currentDate = minCollectionDateA; currentDate < maxEndDateA; currentDate++){
		
		var count = 0;
		
      for(i=0;i<ka;i++){
      	if((avian[i].CollectionDate <= currentDate) && (avian[i].EndDate >= currentDate)){
        	count = count+1; 
        }
      }
      twoDataA.push({Date: currentDate, Value: count });
    }
	
	twoData.push(twoDataH);
	twoData.push(twoDataA);
	return twoData;
}

//Stats//Graph 3: Percent Infected compared to Symptomatic Infection
var graph3Stats = function(d,Population) {
	var minCollectionDate = 1487785065794;
    var maxEndDate = 0;
    var i = 0;
    var k = d.length;
    for(i;i<k;i++){
    	var currentCollectionDate = d[i].CollectionDate;
      var currentEndDate = d[i].EndDate;
      if(currentCollectionDate < minCollectionDate){
      	minCollectionDate = currentCollectionDate;
      }
      if(currentEndDate > maxEndDate){
      	maxEndDate = currentEndDate;
      } 
    }
    var threeData = [];
	var count = 0;
	var symptomCounter = 0;
    for(currentDate = minCollectionDate; currentDate < maxEndDate; currentDate++){
		var i = 0;
      for(i;i<k;i++){
      	if((d[i].CollectionDate <= currentDate) && (d[i].EndDate >= currentDate)){
        	count = count+1; 		
          if(d[i].Symptoms == 1){
          	symptomCounter = symptomCounter + 1;
          }
        }
      }
	  var sympPercent = function() {if (count==0){return 0} else {return (symptomCounter/count)*100}}
	  var sCounter = sympPercent()
	  var countV = (count/Population)*100000
      threeData.push({Date: currentDate, Value: countV, SymptomCount: sCounter});
    }

	return threeData;
}

//Stats//Graph 4: Percent of Infected over Age
var graph4Stats = function(d) {
  var i =0;
  var k = 21
  var fourData = [];
  for(i;i<k;i++){ 
  		var minAge = i * 5;
      var maxAge = (i*5)+4;
      var counter = 0; 
      var g = 0 ;
      var h= d.length;
      for(g;g<h;g++){
      		var currentAge = d[g].Age;
          if((currentAge>= minAge) && (currentAge <= maxAge)) {
          	counter = counter + 1;
          }
      }
      popPercent = counter/h;
      fourData.push({Index: i, PopulationPercent: popPercent});
  }
  return fourData;
}



//Stats//Graph 5: Infections by Strain

var graph5Stats = function (d) {
	strainsVisited = [];
	strainData = [];
	
	for (i=0;i<d.length;i++){
		if (strainsVisited.includes(d[i].Subtype)) {
			var b = 0 //switch
			var t = 0 //loop index
			while (b == 0){
				if (strainData[t].Strain == d[i].Subtype) {
						strainData[t] = {Strain: d[i].Subtype, Count:(strainData[t].Count + 1)}
						b = 1
				} else {t = t+1}}
		}else {
			strainData.push({Strain: d[i].Subtype,Count:1})
			strainsVisited.push(d[i].Subtype);
			}
	}
		
	var sorter = function (s) {
		if  (s.toUpperCase() == "H1N1".toUpperCase()){return 0}else if
			(s.toUpperCase() == "H3".toUpperCase()){return 1}else if
			(s.toUpperCase() == "H3N2".toUpperCase()){return 2}else if
			(s.toUpperCase() == "HXNX".toUpperCase()){return 3}else
			{return 4}
			}
	for (i=0;i<strainData.length;i++){
		strainData[i] = {Index: sorter(strainData[i].Strain) , Strain: strainData[i].Strain, Count: strainData[i].Count}
		}
	strainData.sort(function(a, b) {
    return a.Index - b.Index;
	});
	
	return strainData;

}

//*************************************GRAPHS****************************************************

//svg container				
	var SVG = d3.select('body')
		.append('svg')
		.attr('width', 2000)
		.attr('height', 5000)


//Graph//Graph 1: The Map...	
var width = 960,
    height = 500;

var projection = d3.geoAlbersUsa();
var path = d3.geoPath()
    .projection(projection);

d3.json("us.json", function(error, us) {

  SVG.append("path")
      .attr("class", "states")
	  .attr('transform','translate(50,100)')
      .datum(topojson.feature(us, us.objects.states))
      .attr("d", path);

  
});


//Graph//Graph 2: Quantity of Infections

var graph2a = SVG.append("g");
var graph2b = SVG.append("g");

var dataset2 = graph2Stats(sharedHuman,sharedAvian)

//Scales for line graph
	//For line chart
	var xScale2 = d3.scaleLinear()
		.domain([15595,15841])
		.range([0,500]);
	var yScale2 = d3.scaleLinear()
		.domain([0,200])
		.range([500,0]);

	var line2a = d3.line()
		.x(function(d) { 
			return xScale2(d.Date); 
			})
		.y(function(d) { 
			return yScale2(d.Value); 
			})
		
		
	var line2b = d3.line()
		.x(function(d) { 
			return xScale2(d.Date); 
			})
		.y(function(d) { 
			return yScale2(d.Value); 
			})
	
		graph2a.append('path')
		.datum(dataset2[0])
		.attr('d', line2a)
		.attr('transform','translate(50,800)')
		.attr('fill','none')
		.attr('stroke','black')
		.attr('stroke-width',2)
		
		graph2b.append('path')
		.datum(dataset2[1])
		.attr('d', line2b)
		.attr('transform','translate(50,800)')
		.attr('fill','none')
		.attr('stroke','red')
		.attr('stroke-width',2)
		
	/*	
		graph2a.selectAll('lineChart')
		.data(dataset2[0])
        .enter()
		.append('circle')
        .attr('transform','translate(50,800)')
        .attr('cy',function (d) {
                    return yScale2(d.Value);
                    })
        .attr('cx',function (d) {
                    return xScale2(d.Date);
                    })
		.attr('r',4)		
        .attr('fill', 'black')

			
		graph2b.selectAll('lineChart')
		.data(dataset2[1])
        .enter()
		.append('circle')
        .attr('transform','translate(50,800)')
        .attr('cy',function (d) {
                    return yScale2(d.Value);
                    })
        .attr('cx',function (d) {
                    return xScale2(d.Date);
                    })
		.attr('r',4)		
        .attr('fill', 'red')
	*/


//Graph//Graph 3: Percent Infected compared to Symptomatic Infection

var dataset3 = graph3Stats(humanData,totalPop)

var graph3a = SVG.append("g");
var graph3b = SVG.append("g");
//Scales for line graph
	//For line chart
	var xScale3 = d3.scaleLinear()
		.domain([15595,15841])
		.range([0,500]);
	var yScale3 = d3.scaleLinear()
		.domain([0,38])
		.range([500,0]);

	var line3a = d3.line()
		.x(function(d) { 
			return xScale3(d.Date); 
			})
		.y(function(d) { 
			return yScale3(d.SymptomCount); 
			})
		
		
	var line3b = d3.line()
		.x(function(d) { 
			return xScale3(d.Date); 
			})
		.y(function(d) { 
			return yScale3(d.Value); 
			})
			
		graph3a.append('path')
		.datum(dataset3)
		.attr('d', line3a)
		.attr('transform','translate(600,800)')
		.attr('fill','none')
		.attr('stroke','red')
		.attr('stroke-width',2)
		
		graph3b.append('path')
		.datum(dataset3)
		.attr('d', line3b)
		.attr('transform','translate(600,800)')
		.attr('fill','none')
		.attr('stroke','black')
		.attr('stroke-width',2)
		
		/*
		graph3a.selectAll('lineChart')
		.data(dataset3)
        .enter()
		.append('circle')
        .attr('transform','translate(600,800)')
        .attr('cy',function (d) {
                    return yScale3(d.SymptomCount);
                    })
        .attr('cx',function (d) {
                    return xScale3(d.Date);
                    })
		.attr('r',4)		
        .attr('fill', 'red')
		.on("click", function(d){
			console.log(d.Date)
			console.log(d.SymptomCount)
			})
				
		graph3b.selectAll('lineChart')
		.data(dataset3)
        .enter()
		.append('circle')
        .attr('transform','translate(600,800)')
        .attr('cy',function (d) {
                    return yScale3(d.Value);
                    })
        .attr('cx',function (d) {
                    return xScale3(d.Date);
                    })
		.attr('r',4)		
        .attr('fill', 'purple')
		.on("click", function(d){
			console.log(d.Date)
			console.log(d.Value)
			})
		*/


//Graph//Graph 4: Percent of Infected over Age
var graph4a = SVG.append("g");
var graph4b = SVG.append("g");

var dataset4 = graph4Stats(humanData)

//Scales for line graph
	//For line chart
	var xScale4 = d3.scaleLinear()
		.domain([0,20])
		.range([0,500]);
	var yScale4 = d3.scaleLinear()
		.domain([0,0.3])
		.range([500,1]);

  var line4a = d3.line()
		.x(function(d) { 
			return xScale4(d.Index); 
			})
		.y(function(d) { 
			return yScale4(d.PopulationPercent); 
			})
		
	var line4b = d3.line()
		.x(function(d) { 
			return xScale4(d.Index); 
			})
		.y(function(d) { 
			return yScale4(d.Percent); 
			})
			
		graph4a.append('path')
		.datum(dataset4)
		.attr('d', line4a)
		.attr('transform','translate(50,1200)')
		.attr('fill','none')
		.attr('stroke','red')
		.attr('stroke-width',2)
		
		graph4b.append('path')
		.datum(ageCohorts)
		.attr('d', line4b)
		.attr('transform','translate(50,1200)')
		.attr('fill','none')
		.attr('stroke','black')
		.attr('stroke-width',2)
		
		
		graph4a.selectAll('lineChart')
		.data(dataset4)
        .enter()
		.append('circle')
        .attr('transform','translate(50,1200)')
        .attr('cy',function (d) {
                    return yScale4(d.PopulationPercent);
                    })
        .attr('cx',function (d) {
                    return xScale4(d.Index);
                    })
		.attr('r',4)		
        .attr('fill', 'red')
		.on("click", function(d){
			var fh = filterAge(humanData,d.Index)
			var fa = sharedAvian
			console.log(d.PopulationPercent)
			console.log(d.Index*5 + " to " + (d.Index*5+4))
			dispatch.call('graph',this,fh,fa,4)
			graph4a.selectAll('circle')
			.transition()
			.attr('fill','red')
			.attr('r',4)
			graph4b.selectAll('circle')
			.transition()
			.attr('fill','black')
			.attr('r',4)
			d3.select(this)
			.transition()
			.attr('r',8)
			})
			
	graph4b.selectAll('lineChart')
		.data(ageCohorts)
        .enter()
		.append('circle')
        .attr('transform','translate(50,1200)')
        .attr('cy',function (d) {
                    return yScale4(d.Percent);
                    })
        .attr('cx',function (d) {
                    return xScale4(d.Index);
                    })
		.attr('r',4)		
        .attr('fill', 'black')
		.on("click", function(d){
			var fh = filterAge(humanData,d.Index)
			var fa = sharedAvian
			console.log(d.Age)
			dispatch.call('graph',this,fh,fa,4)
			graph4a.selectAll('circle')
			.transition()
			.attr('fill','red')
			.attr('r',4)
			graph4b.selectAll('circle')
			.transition()
			.attr('fill','black')
			.attr('r',4)
			d3.select(this)
			.transition()
			.attr('r',8)
			})
	


//Graph//Graph 5: Infections by Strain
var graph5a = SVG.append("g");
var graph5b = SVG.append("g");

var barDatasetH = graph5Stats(sharedHuman)
var barDatasetA = graph5Stats(sharedAvian)

	var xScale5 = d3.scaleLinear()
		.domain([0,barDatasetH.length-1])
		.range([0,500]);
	var yScale5 = d3.scaleLinear()
		.domain([0,0.7])
		.range([200,20]);
	
	graph5a.selectAll("bar")
		.data(barDatasetH)
		.enter()
		.append('rect')
		.attr('transform','translate(600,1500)')
		.attr('x', function (d) { 
					return xScale5(d.Index);
					})
		.attr('y', function (d) { 
					return yScale5(d.Count/1063);
					})
		.attr('width', 20)
		.attr('height', function (d) { 
					return 200 - yScale5(d.Count/1063);
					})
		.attr('fill','black')
		.attr('stroke','red')
		.on("click", function(d){
			var fh = filterStrain(sharedHuman,d.Strain)
			var fa = filterStrain(sharedAvian,d.Strain)
			console.log(d.Strain)
			dispatch.call('graph',this,fh,fa,5)
			graph5a.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5b.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			d3.select(this)
			.transition()
			.style('opacity',1)
		})
	
	graph5b.selectAll("bar")
		.data(barDatasetA)
		.enter()
		.append('rect')
		.attr('transform','translate(600,1500)')
		.attr('x', function (d) { 
					return xScale5(d.Index)+20;
					})
		.attr('y', function (d) { 
					return yScale5(d.Count/1017);
					})
		.attr('width', 20)
		.attr('height', function (d) { 
					return 200 - yScale5(d.Count/1017);
					})
		.attr('fill','red')
		.attr('stroke','black')
		.on("click", function(d){
			var fh = filterStrain(sharedHuman,d.Strain)
			var fa = filterStrain(sharedAvian,d.Strain)
			console.log(d.Strain)
			dispatch.call('graph',this,fh,fa,5)
			graph5a.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5b.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			d3.select(this)
			.transition()
			.style('opacity',1)
		})

var dispatch = d3.dispatch('graph');


//*************************************DISPATCHES****************************************************

//Dispatch//Graph 1: The Map...	
dispatch.on('graph.one', function(filtered,avian,clicked){
	if (clicked !== 1) {
	
	console.log('where G1 will be')
	
	}
	})
	
//Dispatch//Graph 2: Quantity of Infections
dispatch.on('graph.two', function(filteredH,filteredA,clicked){

if (clicked == 1 || clicked == 4 || clicked == 5) {
var dataset = graph2Stats(filteredH,filteredA)
	graph2a.selectAll('path')
		.datum(dataset[0])
		.transition()
		.attr('d', line2a)
		
	graph2b.selectAll('path')
		.datum(dataset[1])
		.transition()
		.attr('d', line2b)
	/*	
	graph2a.selectAll('circle')
		.data(dataset[0])
		.transition()
        .attr('cy',function (d) {
                    return yScale2(d.Value);
                    })
		.attr('r',4)		
        .attr('fill', 'black')
		
	graph2b.selectAll('circle')
		.data(dataset[1])
		.transition()
        .attr('cy',function (d) {
                    return yScale2(d.Value);
                    })
		.attr('r',4)		
        .attr('fill', 'red')
		
		*/
		}
	})
	
//Dispatch//Graph 3: Percent Infected compared to Symptomatic Infection
dispatch.on('graph.three', function(filtered,avian,clicked){

var dataset = graph3Stats(filtered,totalPop)
	
	if (clicked !== 3) {
	
	graph3a.selectAll('path')
		.datum(dataset)
		.transition()
		.attr('d', line3a)
		
	graph3b.selectAll('path')
		.datum(dataset)
		.transition()
		.attr('d', line3b)
	/*
	graph3a.selectAll('circle')
		.data(dataset)
		.transition()
        .attr('cy',function (d) {
                    return yScale3(d.SymptomCount);
                    })
		.attr('r',4)		
        .attr('fill', 'red')
		
	graph3b.selectAll('circle')
		.data(dataset)
		.transition()
        .attr('cy',function (d) {
                    return yScale3(d.Value);
                    })
		.attr('r',4)		
        .attr('fill', 'purple')
		
		*/
		}
		
	})
	
//Dispatch//Graph 4: Percent of Infected over Age
dispatch.on('graph.four', function(filtered,avian,clicked){

if (clicked !== 4) {
var dataset = graph4Stats(filtered)

	graph4a.selectAll('path')
		.datum(dataset)
		.transition()
		.attr('d', line4a)
			
	graph4a.selectAll('circle')
		.data(dataset)
		.transition()
        .attr('cy',function (d) {
                    return yScale4(d.PopulationPercent);
                    })
		.attr('r',4)		
		
	graph4b.selectAll('circle')
		.transition()
		.attr('r',4)		

	}
	
	})
	
//Dispatch//Graph 5: Infections by Strain	
dispatch.on('graph.five', function(filteredH,filteredA,clicked){

if (clicked ==! 5){

var datasetH = graph5Stats(filteredH)
var datasetA = graph5Stats(filteredA)

	graph5a.selectAll("rect")
		.data(datasetH)
		.transition()
		.attr('y', function (d) { 
					return yScale5(d.Count);
					})
		.attr('height', function (d) { 
					return 201 - yScale5(d.Count);
					})
		.attr('fill','black')
		.attr('stroke','red')
		.style('opacity',1)
		
		
		
	graph5b.selectAll("rect")
		.data(datasetA)
		.transition()
		.attr('y', function (d) { 
					return yScale5(d.Count);
					})
		.attr('height', function (d) { 
					return 201 - yScale5(d.Count);
					})
		.attr('fill','black')
		.attr('stroke','red')
		.style('opacity',1)
		}
	})
	
})
})

	</script>
</body>

</html>


