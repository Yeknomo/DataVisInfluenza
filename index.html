<!DOCTYPE html>
<html>

<head>
	<title>Assignment 4</title>
	<script src='https://d3js.org/d3.v4.min.js'></script>
</head>
 
<body>

	<script>

d3.csv('avianData.csv', function(error,avianData){	
d3.csv('humanData.csv', function (error,humanData){


avianData.forEach(function(d) {
        d.CollectionDate = d.CollectionDate.split("/");
		d.CollectionDate = d.CollectionDate[2].concat(d.CollectionDate[1]).concat(d.CollectionDate[0]);
		d.CollectionDate = +d.CollectionDate;
    })
humanData.forEach(function(d) {
		d.Age = d.Age.split(",");
		d.Age = d.Age[0];
		
		d.CollectionDate = d.CollectionDate.split(",");
		d.CollectionDate = d.CollectionDate[0];
		d.CollectionDate = d.CollectionDate.split("/");
		d.CollectionDate = d.CollectionDate[2].concat(d.CollectionDate[1]).concat(d.CollectionDate[0]);
		d.CollectionDate = +d.CollectionDate;
		
		if (d.Temperature == "-N/A-") {
			d.Temperature = "0"
			}
		d.Temperature = +d.Temperature;
		
		if (d.isVaccinated == "1" || d.isVaccinated == "Yes" || d.isVaccinated == "Y") {
			d.isVaccinated = "Y"
			}else {d.isVaccinated = "N"}
		
		if (d.Fever == "1" || d.Fever == "Yes" || d.Fever == "Y") {
			d.Fever = "Y"
			}else {d.Fever = "N"}
			
		d.Symptoms = d.Symptoms.split(",")
		console.log(d.Symptoms)
		d.Subtype = d.Subtype.split(",");
		d.Subtype = d.Subtype[0];
		if (d.Subtype == "-N/A-" || d.Subtype == "unknown"){
			d.Subtype = "-N/A-"
			}
})



var ageCohorts = [
	{Index: '0',  Age: 'Under 5' , Percent: 0.0654304581399327}, 
	{Index: '1',  Age: '5 to 9' , Percent: 0.065907533860457 } ,
	{Index: '2',  Age: '10 to 14' , Percent: 0.0669716366880742 }, 
	{Index: '3',  Age: '15 to 19' , Percent: 0.0713867579844992 } ,
	{Index: '4',  Age: '20 to 24' , Percent: 0.0699151772033059 } ,
	{Index: '5',  Age: '25 to 29' , Percent: 0.0683470573751255 } ,
	{Index: '6',  Age: '30 to 34' , Percent: 0.0646555060497749 } ,
	{Index: '7',  Age: '35 to 39' , Percent: 0.065360108945121 } ,
	{Index: '8',  Age: '40 to 44' , Percent: 0.067664019163898 } ,
	{Index: '9',  Age: '45 to 49' , Percent: 0.0735511552558858 } ,
	{Index: '10',  Age: '50 to 54' , Percent: 0.0722216915082996 } ,
	{Index: '11',  Age: '55 to 59' , Percent: 0.0636925965874202 } ,
	{Index: '12',  Age: '60 to 64' , Percent: 0.0544717961235767 } ,
	{Index: '13',  Age: '65 to 69' , Percent: 0.0402767375378231 } ,
	{Index: '14',  Age: '70 to 74' , Percent: 0.0300511743751905 } ,
	{Index: '15',  Age: '75 to 79' , Percent: 0.0237017028566742 } ,
	{Index: '16',  Age: '80 to 84' , Percent: 0.0186021376606907 } ,
	{Index: '17',  Age: '85 to 89' , Percent: 0.0117263524631083 } ,
	{Index: '18',  Age: '90 to 94' , Percent: 0.00469113176301191} ,
	{Index: '19',  Age: '95 to 99' , Percent: 0.00120242709386135} ,
	{Index: '20',  Age: '100+' , Percent: 0.000172841364269368 }  ];
	
	
var predictedStrains = ["H1N1" ,"H3N2"]; 


//svg container				
	var SVG = d3.select('body')
		.append('svg')
		.attr('width', 1000)
		.attr('height', 1000);
		
var addTXT = function(current){
	SVG.selectAll("text").remove()
	
	SVG.append("text")
			.attr("x", 370)
			.attr("y", 950)
			.text("Page: ")
			.attr("font-size", "30px")
			.attr("fill","black")

	SVG.append("text")						
			.attr("x", 450)
			.attr("y", 950)
			.text("1")
			.attr("font-size", "30px")
			.attr("fill", function () {
				if (current == 1) {
				return "black"
				} else {
				return "blue"
					}
			})
			.on("click", function(){
			if (current == 1) {
			}else {
			dispatch.call('page1',this,1)
				}
			});
	
	SVG.append("text")						
			.attr("x", 500)
			.attr("y", 950)
			.text("2")
			.attr("font-size", "30px")
			.attr("fill", function () {
				if (current == 2) {
				return "black"
				} else {
				return "blue"
					}
			})
			.on("click", function(){
			if (current == 2) {
				}else {
			dispatch.call('page2',this,2)
				}
			});
			
	SVG.append("text")						
			.attr("x", 550)
			.attr("y", 950)
			.text("3")
			.attr("font-size", "30px")
			.attr("fill", function () {
				if (current == 3) {
				return "black"
				} else {
				return "blue"
					}
			})
			.on("click", function(){
			if (current == 3) {
			}else {
			dispatch.call('page3',this,3)	
				}
			});
	}
	
addTXT(1);

var graph5Stats = function (d) {
	strainsVisited = [];
	strainData = [];
	
	for (i=0;i<d.length;i++){
		if (strainsVisited.includes(d[i].Subtype)) {
			var b = 0 //switch
			var t = 0 //loop index
			while (b == 0){
				if (strainData[t].Strain == d[i].Subtype) {
						strainData[t] = {Strain: d[i].Subtype, Count:(strainData[t].Count + 1)}
						b = 1
				} else {t = t+1}}
		}else {
			strainData.push({Strain: d[i].Subtype,Count:1})
			strainsVisited.push(d[i].Subtype);
			}
	}
	strainData.sort(function(a, b) {
    return a.Strain - b.Strain;
	});
	
	for (i=0;i<strainData.length;i++){
		strainData[i] = {Index: i , Strain: strainData[i].Strain, Count: strainData[i].Count}
		}
	
	
	return strainData;

}

//Graph 2: Quantity of Infections

var graph2a = SVG.append("g");
var graph2b = SVG.append("g");
//Scales for line graph
	//For line chart
	var xScale3 = d3.scaleLinear()
		.domain([20120000,20169999])
		.range([0,1000]);
	var yScale3 = d3.scaleLinear()
		.domain([0,100])
		.range([500,1]);

	var line1 = d3.line()
		.x(function(d) { 
			return xScale3(d.CollectionDate); 
			})
		.y(function(d) { 
			return yScale3(d.Age); 
			})
		
		
	var line2 = d3.line()
		.x(function(d) { 
			return xScale3(d.CollectionDate); 
			})
		.y(function(d) { 
			return yScale3(d.Temperature); 
			})
			
		graph2a.append('path')
		.datum(humanData)
		.attr('d', line1)
		.attr('transform','translate(1000000,200)')
		.attr('fill','none')
		.attr('stroke','red')
		.attr('stroke-width',2)
		
		graph2b.append('path')
		.datum(humanData)
		.attr('d', line2)
		.attr('transform','translate(10000000,200)')
		.attr('fill','none')
		.attr('stroke','black')
		.attr('stroke-width',2)
		
		
		graph2a.selectAll('lineChart')
		.data(humanData)
        .enter()
		.append('circle')
        .attr('transform','translate(100000,200)')
        .attr('cy',function (d) {
                    return yScale3(d.Age);
                    })
        .attr('cx',function (d) {
                    return xScale3(d.CollectionDate);
                    })
		.attr('r',4)		
        .attr('fill', 'green')
		.on("click", function(d){
			var v = d.Age
			dispatch.call('page3',this,v)
			graph2a.selectAll('circle')
			.transition()
      .attr('fill','black')
			.attr('r',4)
			d3.select(this)
			.transition()
      .attr('fill','red')
			.attr('r',8)
			})
			
		graph2b.selectAll('lineChart')
		.data(humanData)
        .enter()
		.append('circle')
        .attr('transform','translate(1000000,200)')
        .attr('cy',function (d) {
                    return yScale3(d.Temperature);
                    })
        .attr('cx',function (d) {
                    return xScale3(d.CollectionDate);
                    })
		.attr('r',4)		
        .attr('fill', 'purple')
		.on("click", function(d){
			var v = d.Age
			dispatch.call('page3',this,v)
			graph2b.selectAll('circle')
			.transition()
      .attr('fill','black')
			.attr('r',4)
			d3.select(this)
			.transition()
      .attr('fill','red')
			.attr('r',8)
			})



//Graph 3: Percent Infected compared to Symptomatic Infection

var graph3a = SVG.append("g");
var graph3b = SVG.append("g");
//Scales for line graph
	//For line chart
	var xScale3 = d3.scaleLinear()
		.domain([20120000,20169999])
		.range([0,1000]);
	var yScale3 = d3.scaleLinear()
		.domain([0,100])
		.range([500,1]);

	var line1 = d3.line()
		.x(function(d) { 
			return xScale3(d.CollectionDate); 
			})
		.y(function(d) { 
			return yScale3(d.Age); 
			})
		
		
	var line2 = d3.line()
		.x(function(d) { 
			return xScale3(d.CollectionDate); 
			})
		.y(function(d) { 
			return yScale3(d.Temperature); 
			})
			
		graph3a.append('path')
		.datum(humanData)
		.attr('d', line1)
		.attr('transform','translate(1000000,200)')
		.attr('fill','none')
		.attr('stroke','red')
		.attr('stroke-width',2)
		
		graph3b.append('path')
		.datum(humanData)
		.attr('d', line2)
		.attr('transform','translate(10000000,200)')
		.attr('fill','none')
		.attr('stroke','black')
		.attr('stroke-width',2)
		
		
		graph3a.selectAll('lineChart')
		.data(humanData)
        .enter()
		.append('circle')
        .attr('transform','translate(100000,200)')
        .attr('cy',function (d) {
                    return yScale3(d.Age);
                    })
        .attr('cx',function (d) {
                    return xScale3(d.CollectionDate);
                    })
		.attr('r',4)		
        .attr('fill', 'green')
		.on("click", function(d){
			var v = d.Age
			dispatch.call('page3',this,v)
			graph3a.selectAll('circle')
			.transition()
      .attr('fill','black')
			.attr('r',4)
			d3.select(this)
			.transition()
      .attr('fill','red')
			.attr('r',8)
			})
			
		graph3b.selectAll('lineChart')
		.data(humanData)
        .enter()
		.append('circle')
        .attr('transform','translate(1000000,200)')
        .attr('cy',function (d) {
                    return yScale3(d.Temperature);
                    })
        .attr('cx',function (d) {
                    return xScale3(d.CollectionDate);
                    })
		.attr('r',4)		
        .attr('fill', 'purple')
		.on("click", function(d){
			var v = d.Age
			dispatch.call('page3',this,v)
			graph3b.selectAll('circle')
			.transition()
      .attr('fill','black')
			.attr('r',4)
			d3.select(this)
			.transition()
      .attr('fill','red')
			.attr('r',8)
			})

//Graph 4: Percent of Infected over Age
var graph4 = SVG.append("g");

//Scales for line graph
	//For line chart
	var xScale4 = d3.scaleLinear()
		.domain([0,20])
		.range([0,1000]);
	var yScale4 = d3.scaleLinear()
		.domain([0,1])
		.range([500,1]);

  var line = d3.line()
		.x(function(d) { 
			return xScale4(d.Index); 
			})
		.y(function(d) { 
			return yScale4(d.Percent); 
			})
		
		graph4.append('path')
		.datum(ageCohorts)
		.attr('d', line)
		.attr('transform','translate(100000,100)')
		.attr('fill','none')
		.attr('stroke','black')
		.attr('stroke-width',2)
		
		
		graph4.selectAll('lineChart')
		.data(ageCohorts)
        .enter()
		.append('circle')
        .attr('transform','translate(100000,100)')
        .attr('cy',function (d) {
                    return yScale4(d.Percent);
                    })
        .attr('cx',function (d) {
                    return xScale4(d.Index);
                    })
		.attr('r',4)		
        .attr('fill', 'black')
		.on("click", function(d){
			var v = d.Age
			dispatch.call('page3',this,v)
			graph4.selectAll('circle')
			.transition()
      .attr('fill','black')
			.attr('r',4)
			d3.select(this)
			.transition()
      .attr('fill','red')
			.attr('r',8)
			})


//Graph 5: Infections by Strain
var graph5 = SVG.append("g");

var barDataset = graph5Stats(humanData)

	var xScale5 = d3.scaleLinear()
		.domain([0,barDataset.length-1])
		.range([0,500]);
	var yScale5 = d3.scaleLinear()
		.domain([1,400])
		.range([200,1]);
	
	graph5.selectAll("bar")
		.data(barDataset)
		.enter()
		.append('rect')
		.attr('transform','translate(10200,70)')
		.attr('x', function (d) { 
					return xScale5(d.Index);
					})
		.attr('y', function (d) { 
					return yScale5(d.Count);
					})
		.attr('width', 20)
		.attr('height', function (d) { 
					return 201 - yScale5(d.Count);
					})
		.attr('fill','black')
		.attr('stroke','red')
		.on("click", function(d){
			var v = d.Strain
			dispatch.call('page3',this,v)
			graph5.selectAll('rect')
			.transition()
      .attr('fill','black')
			.style('opacity',0.5)
			d3.select(this)
			.transition()
      .attr('fill','red')
			.style('opacity',1)
		})
	

var dispatch = d3.dispatch('page1', 'page2','page3');

dispatch.on('page1', function(current){
	console.log('called page1') 
	addTXT(current)
	})

dispatch.on('page2', function(current){
	console.log('called page2') 
	addTXT(current)
	})

//Graph 1: The Map...	
dispatch.on('page3.graph1', function(current){
	console.log('called g1') 
	addTXT(current)
	})
	
//Graph 2: Quantity of Infections
dispatch.on('page3.graph2', function(current){
	
	graph2a.selectAll('path')
		.datum(humanData)
		.attr('transform','translate(500,100)')	
		.transition()
		.attr('d', line1)
		
	graph2b.selectAll('path')
		.datum(humanData)
		.attr('transform','translate(500,100)')	
		.transition()
		.attr('d', line2)
		
	graph2a.selectAll('circle')
		.data(humanData)
		.attr('transform','translate(500,100)')
		.transition()
        .attr('cy',function (d) {
                    return yScale3(d.Age);
                    })
		.attr('r',4)		
        .attr('fill', 'green')
		
	graph2b.selectAll('circle')
		.data(humanData)
		.attr('transform','translate(500,100)')
		.transition()
        .attr('cy',function (d) {
                    return yScale3(d.Temperature);
                    })
		.attr('r',4)		
        .attr('fill', 'purple')
	
	addTXT(current)
	})
	
//Graph 3: Percent Infected compared to Symptomatic Infection
dispatch.on('page3.graph3', function(current){
	
	graph3a.selectAll('path')
		.datum(humanData)
		.attr('transform','translate(120,100)')	
		.transition()
		.attr('d', line1)
		
	graph3b.selectAll('path')
		.datum(humanData)
		.attr('transform','translate(120,100)')	
		.transition()
		.attr('d', line2)
		
	graph3a.selectAll('circle')
		.data(humanData)
		.attr('transform','translate(120,100)')
		.transition()
        .attr('cy',function (d) {
                    return yScale3(d.Age);
                    })
		.attr('r',4)		
        .attr('fill', 'green')
		
	graph3b.selectAll('circle')
		.data(humanData)
		.attr('transform','translate(120,100)')
		.transition()
        .attr('cy',function (d) {
                    return yScale3(d.Temperature);
                    })
		.attr('r',4)		
        .attr('fill', 'purple')
	
	addTXT(current)
	})
	
//Graph 4: Percent of Infected over Age
dispatch.on('page3.graph4', function(current){
	
	graph4.selectAll('path')
		.datum(ageCohorts)
		.attr('transform','translate(120,100)')	
		.transition()
		.attr('d', line)
		
	graph4.selectAll('circle')
		.data(ageCohorts)
		.attr('transform','translate(120,100)')
		.transition()
        .attr('cy',function (d) {
                    return yScale4(d.Percent);
                    })
		.attr('r',4)		
        .attr('fill', 'black')
	
	addTXT(current) 
	})
	
//Graph 5: Infections by Strain	
dispatch.on('page3.graph5', function(current){

var dataset = graph5Stats(humanData)

	graph5.selectAll("rect")
		.data(dataset)
		.attr('transform','translate(200,70)')
		.transition()
		.attr('y', function (d) { 
					return yScale5(d.Count);
					})
		.attr('height', function (d) { 
					return 201 - yScale5(d.Count);
					})
		.attr('fill','black')
		.attr('stroke','red')
		.style('opacity',1)
	
	addTXT(current)
	})
	
})
})

	</script>
</body>

</html>


